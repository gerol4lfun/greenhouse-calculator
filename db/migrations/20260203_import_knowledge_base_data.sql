-- Импорт данных базы знаний через SQL
-- Дата: 2026-02-03
-- 
-- ИНСТРУКЦИЯ:
-- 1. Откройте Supabase Dashboard → SQL Editor
-- 2. Скопируйте весь этот SQL код
-- 3. Вставьте и нажмите Run
-- 4. Должно импортироваться 24 карточки (GH-0011 пропущен, т.к. deprecated)

-- Импорт всех карточек (upsert - если уже есть, обновит)
INSERT INTO knowledge_base (id, type, audience, title, text, tags, source_ref, needs_input, needs_from_owner, deprecated, kb_version) VALUES
('GH-0001', 'FACT', 'internal_only', '«Дорого» — причины', '«Дорого» обычно не значит «нет денег».
Чаще причина: клиент не видит ценность/разницу, сравнивает без деталей или боится переплатить.
Иногда это торг или удобный способ закончить разговор.', ARRAY['возражение_дорого', 'психология', 'скрипты'], '{"post_id": 21, "date": "2025-02-12T12:06:01", "line_no": 9}'::jsonb, false, '', false, 'v1.0'),

('GH-0002', 'HOWTO', 'internal_only', '«Дорого» — алгоритм', 'Алгоритм на «дорого»:
1) Спокойно принять, не спорить.
2) Уточнить, с чем сравнивает и какие характеристики важны.
3) Если вариант «дешевле» — подсветить типичные места экономии (тонкий металл/слабый каркас/ПК без УФ-защиты).
4) Показать ценность и последствия «экономии».
5) Дать выбор вариантов, без давления.', ARRAY['возражение_дорого', 'как_отрабатывать', 'скрипты'], '{"post_id": 21, "date": "2025-02-12T12:06:01", "line_no": 9}'::jsonb, false, '', false, 'v1.0'),

('GH-0003', 'FACT', 'client_safe', 'Оплата: порядок', 'Способы оплаты: наличные или QR код.
Предоплата не нужна: оплата после доставки, а при сборке — после её завершения.', ARRAY['оплата', 'доверие', 'условия'], '{"post_id": 4, "date": "2025-02-10T15:30:32", "line_no": 2}'::jsonb, false, '', false, 'v1.0'),

('GH-0004', 'HOWTO', 'internal_only', '«Подумаю» → бронь', 'Когда клиент говорит «я подумаю», цель — предложить бронирование, чтобы зафиксировать текущую стоимость.
Подход:
— подтвердить право подумать
— предложить бронь без предоплаты
— обозначить, что бронь можно отменить, если планы поменялись
Пример формулировки в посте: «…давайте оформим бронь — это бесплатно и без предоплаты. Если передумаете, просто отменим.»', ARRAY['бронирование', 'закрытие', 'процесс'], '{"post_id": 52, "date": "2025-02-21T16:50:07", "line_no": 25}'::jsonb, false, '', false, 'v1.0'),

('GH-0005', 'HOWTO', 'internal_only', 'Бронь: фишки', 'Как лучше закрывать на бронирование:
1) Брать инициативу: предлагать бронь как следующий шаг.
2) Объяснять ограниченность: «скидки фиксируются только при бронировании», ближе к сезону цена выше.
3) Не спрашивать «будете?», а предлагать действие.
4) По возможности оформлять по телефону, не теряя клиента после звонка.', ARRAY['бронирование', 'скрипты', 'инициатива'], '{"post_id": 31, "date": "2025-02-15T07:03:42", "line_no": 13}'::jsonb, false, '', false, 'v1.0'),

('GH-0006', 'HOWTO', 'internal_only', '«Усиленная» — уточнять', 'Запрос «усиленная теплица»:
1) Не предлагать «наугад» — сначала уточнить, что клиент имеет в виду.
2) Варианты для уточнения: усиленный каркас/частый шаг дуг 0.65/труба 40×20/двойная дуга.
3) После уточнения сделать расчёт под выбранное «усиление».
4) Если клиент не знает — ориентировать по нагрузке и условиям.', ARRAY['усиление', 'квалификация', 'скрипты'], '{"post_id": 46, "date": "2025-02-20T09:54:35", "line_no": 22}'::jsonb, false, '', false, 'v1.0'),

('GH-0007', 'FACT', 'internal_only', '«Усиленная» — что это', 'Единого определения «усиленной теплицы» нет.
Клиенты чаще называют усилением: трубу 40×20; шаг дуг 0.65 м; двойную дугу 20×20+20×20 или 40×20+20×20.', ARRAY['усиление', 'термины'], '{"post_id": 46, "date": "2025-02-20T09:54:35", "line_no": 22}'::jsonb, false, '', false, 'v1.0'),

('GH-0008', 'FACT', 'internal_only', 'Усиление: уровни', 'Если клиент сам не знает, что нужно:
— Стандарт: 40×20 мм, шаг 1 м, краб-система.
— Усиленная: шаг 0.65 м или двойная дуга.
— Максимально усиленная: 40×20+20×20, двойная дуга + шаг 0.65 м.', ARRAY['усиление', 'градации'], '{"post_id": 46, "date": "2025-02-20T09:54:35", "line_no": 22}'::jsonb, false, '', false, 'v1.0'),

('GH-0009', 'FACT', 'client_safe', 'Арочная: ширина 4 м', 'Ширина 4 м относится к «промышленным» и требует усиленной конструкции.
В посте: высота растёт с ~2.1 м до ~2.8 м, стандартный каркас не выдержит нагрузки.
Усиление делается за счёт двойной трубы, большего числа стяжек и доп. соединителей.
«Растянуть» стандартную модель до 4 м без доработок нельзя.', ARRAY['арочная', 'размеры', 'усиление'], '{"post_id": 33, "date": "2025-02-15T15:12:22", "line_no": 14}'::jsonb, false, '', false, 'v1.0'),

('GH-0010', 'FACT', 'client_safe', 'Краб-система', 'Краб-система — это соединители («крабы») для каркаса, крепятся на 4 болтах.
Повышают прочность и устойчивость к снеговым и ветровым нагрузкам.
Распределяют нагрузку и помогают предотвращать деформации.', ARRAY['конструкция', 'краб_система'], '{"post_id": 3, "date": "2025-02-10T15:30:06", "line_no": 1}'::jsonb, false, '', false, 'v1.0'),

('GH-0012', 'FACT', 'client_safe', 'Гарантия: 15 лет', 'Гарантия: 15 лет.
Выдается гарантийный лист с описанием условий.', ARRAY['гарантия', 'документы'], '{"post_id": 4, "date": "2025-02-10T15:30:32", "line_no": 2}'::jsonb, false, '', false, 'v1.0'),

('GH-0013', 'HOWTO', 'internal_only', 'Шаблоны: когда слать', 'Как использовать шаблоны в переписке:
— «кредит/частями»: вместо рассрочки предложить бронирование без предоплаты и сохранение цены.
— «где производство»: объяснить, что склады закрыты для посетителей, работаем онлайн.
— «заказ оформлен/в работу»: подтвердить, что заказ передан на склад.
— «данные для оформления»: запросить ФИО, адрес, телефон и дату доставки.
— «шаблон заказа»: письменно зафиксировать модель/цену/сборку/доставку и дождаться подтверждения.', ARRAY['шаблоны', 'crm', 'процесс'], '{"post_id": 95, "date": "2025-03-07T18:22:26", "line_no": 48}'::jsonb, false, '', false, 'v1.0'),

('GH-0014', 'FACT', 'client_safe', 'Рассрочка и хранение', 'Рассрочка: не предоставляется.
Можно зафиксировать цену и хранить до весны (цена фиксируется сразу).', ARRAY['условия', 'хранение', 'рассрочка'], '{"post_id": 4, "date": "2025-02-10T15:30:32", "line_no": 2}'::jsonb, false, '', false, 'v1.0'),

('GH-0015', 'HOWTO', 'internal_only', 'Доставка: не обещать время', 'Правила коммуникации по доставке:
— Не обещать звонок от водителя накануне.
— Не называть точное время прибытия.
— Доставка всегда «в течение дня».
— Звонок будет только в день доставки, когда машина поедет на адрес.
— Даже «примерное время» не гарантия: на предыдущем адресе могут задержать на 2–3 часа.
Клиенту проговариваем: «Доставка в течение дня, водитель свяжется, когда поедет на ваш адрес».', ARRAY['доставка', 'логистика', 'правила'], '{"post_id": 212, "date": "2025-05-08T08:51:34", "line_no": 94}'::jsonb, false, '', false, 'v1.0'),

('GH-0016', 'FACT', 'internal_only', 'Доставка: регионы складов', 'Доставка только по городам (и их областям/краям), где есть наши склады.
Если города нет в списке — не доставляем; если есть — доставка по всему региону/области.
Список городов складов хранится в отдельном справочнике. Здесь — принцип: доставляем по регионам складов.', ARRAY['доставка', 'география'], '{"post_id": 3, "date": "2025-02-10T15:30:06", "line_no": 1}'::jsonb, false, '', false, 'v1.0'),

('GH-0017', 'FACT', 'internal_only', 'Доставка: тариф', 'Формула доставки: 40 руб/км, но не менее 1000 руб.', ARRAY['доставка', 'цены'], '{"post_id": 3, "date": "2025-02-10T15:30:06", "line_no": 1}'::jsonb, false, '', false, 'v1.0'),

('GH-0018', 'FACT', 'internal_only', 'Доставка без сборки +500', 'Если клиент отказывается от сборки: +500 руб к итоговой цене доставки.', ARRAY['доставка', 'цены', 'сборка'], '{"post_id": 3, "date": "2025-02-10T15:30:06", "line_no": 1}'::jsonb, false, '', false, 'v1.0'),

('GH-0019', 'HOWTO', 'client_safe', 'Основание: почему нужно', 'Как объяснять, почему нельзя ставить теплицу просто на землю:
— может снести ветром
— каркас со временем может деформироваться
— могут пролезть грызуны
— будет теряться тепло
На что ставим: наш брус / наши грунтозацепы / фундамент клиента (брус, бетон и т.д.).', ARRAY['установка', 'основание', 'аргументы'], '{"post_id": 109, "date": "2025-03-12T08:51:19", "line_no": 57}'::jsonb, false, '', false, 'v1.0'),

('GH-0020', 'FACT', 'client_safe', 'Установка vs закрепление', 'Установка: собрать каркас и поставить на брус/фундамент клиента без доп. креплений.
Закрепление: жёстко крепить теплицу к основанию, чтобы не двигалась и не сдвигалась ветром.', ARRAY['установка', 'закрепление', 'термины'], '{"post_id": 109, "date": "2025-03-12T08:51:19", "line_no": 32}'::jsonb, false, '', false, 'v1.0'),

('GH-0021', 'FACT', 'internal_only', 'Фундамент клиента: доплаты', 'Монтаж на фундамент клиента:
— Брус (клиентский): +1500 руб (сверлим отверстия и прикручиваем к его брусу).
— Бетон: +2000 руб (отверстия перфоратором + крепление анкерами).
Прочие строительные работы (ремонт, заливка фундамента и т.п.) не оказываем.', ARRAY['сборка', 'фундамент_клиента', 'цены'], '{"post_id": 3, "date": "2025-02-10T15:30:06", "line_no": 1}'::jsonb, false, '', false, 'v1.0'),

('GH-0022', 'FACT', 'internal_only', 'Сборка: что входит', 'В обычную стоимость сборки входит:
— сборка каркаса теплицы
— закрепление к нашему брусу или нашим грунтозацепам (если клиент их заказал).', ARRAY['сборка', 'комплектация'], '{"post_id": 109, "date": "2025-03-12T08:51:19", "line_no": 57}'::jsonb, false, '', false, 'v1.0'),

('GH-0023', 'FACT', 'client_safe', 'ПК: новые данные', 'Обновление по поликарбонату: производитель изменил показатели плотности.
Актуально: Стандарт 4 мм — 0.47 кг/м² (гарантия 10 лет); Люкс 4 мм — 0.52 кг/м² (15 лет); Премиум 6 мм — 0.8 кг/м² (15 лет).
В общении и расчётах используем только эти данные.', ARRAY['поликарбонат', 'плотность', 'гарантия'], '{"post_id": 432, "date": "2025-11-09T07:27:58", "line_no": 170}'::jsonb, false, '', false, 'v1.0'),

('GH-0024', 'HOWTO', 'internal_only', 'ПК: объяснять изменение', 'Если клиент спрашивает, почему изменилась плотность:
1) Спокойно сказать: «Производитель обновил технические характеристики».
2) Пояснение: производитель обновил показатели; в расчётах используем актуальные значения; гарантия по данным производителя сохранилась.
3) Использовать только актуальные показатели в расчётах.', ARRAY['поликарбонат', 'скрипт', 'возражения'], '{"post_id": 432, "date": "2025-11-09T07:27:58", "line_no": 170}'::jsonb, false, '', false, 'v1.0'),

('GH-0025', 'FACT', 'internal_only', 'ПК: доп. листы', 'Доп. листы поликарбоната 2.1×6 м:
Стандарт — 3000 руб; Люкс — 3500 руб; Премиум — 4000 руб.', ARRAY['поликарбонат', 'доп_листы', 'цены'], '{"post_id": 3, "date": "2025-02-10T15:30:06", "line_no": 1}'::jsonb, false, '', false, 'v1.0')

ON CONFLICT (id) DO UPDATE SET
    type = EXCLUDED.type,
    audience = EXCLUDED.audience,
    title = EXCLUDED.title,
    text = EXCLUDED.text,
    tags = EXCLUDED.tags,
    source_ref = EXCLUDED.source_ref,
    needs_input = EXCLUDED.needs_input,
    needs_from_owner = EXCLUDED.needs_from_owner,
    deprecated = EXCLUDED.deprecated,
    kb_version = EXCLUDED.kb_version,
    updated_at = NOW();

-- Проверка результата
SELECT 
    COUNT(*) as total_cards, 
    COUNT(*) FILTER (WHERE deprecated = false) as active_cards,
    COUNT(*) FILTER (WHERE deprecated = true) as deprecated_cards
FROM knowledge_base;
